<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: views/secretaria/vistagestioncertificados.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: views/secretaria/vistagestioncertificados.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// vistagestioncertificados.js
import {Vista} from '../vista.js'; 

export class VistaGestionCertificados extends Vista {
    /**
     * @param {ControladorSecretaria} controlador
     * @param {HTMLElement} divContenedor
     */
    constructor(controlador, divContenedor) {
        // Llama al constructor de la clase base
        super(controlador, divContenedor); 

        this.controlador = controlador;
        this.div = divContenedor;
        // Busca el elemento de la tabla dentro del divContenedor
        this.tabla = divContenedor.querySelector('#tablaCertificados');
        this.thead = null; 
        this.tbody = null;
        
        if (this.tabla) {
            this.thead = this.tabla.querySelector('thead');
            this.tbody = this.tabla.querySelector('tbody');
            //console.log("DEBUG C: tbody encontrado:", !!this.tbody);
            this.inicializar();
        } else {
            console.error("Error: Elemento #tablaCertificados no encontrado en el contenedor.");
        }
    }

    /**
     * Muestra u oculta la vista en el DOM.
     * @param {boolean} visibilidad 
     */
    mostrar(visibilidad = true) {
        if (this.div) {
            if (visibilidad) this.div.classList.remove('d-none');
            else this.div.classList.add('d-none');
        }
    }

    /**
     * Prepara la estructura de la vista (encabezados).
     */
    async inicializar() {
        if (this.thead) {
            // Establecer encabezados de la tabla
            this.thead.innerHTML = `
                &lt;tr>
                    &lt;th>Nombre&lt;/th>
                    &lt;th>Apellidos&lt;/th>
                    &lt;th>Curso&lt;/th>
                    &lt;th>Acciones&lt;/th> 
                &lt;/tr>
            `;
            
        }
    }

    /**
     * Muestra la lista de alumnos en el cuerpo de la tabla.
     * @param {Array&lt;Object>} lista Lista de alumnos.
     */
    pintarListadoAnual(lista) { 
        console.log("DEBUG VISTA CERTIFICADOS: Empezando a pintar", lista.length, "ítems.");
        
        if (!this.tbody) {
            console.error("Error: Cuerpo de tabla (tbody) no encontrado. La tabla no se puede pintar.");
            return;
        }
        
        // Limpiar contenido anterior
        this.tbody.innerHTML = '';
        
        if (!lista || lista.length === 0) {
            const tr = document.createElement('tr');
            tr.innerHTML = `&lt;td colspan="6" class="text-center">No hay alumnos que cumplan el criterio.&lt;/td>`;
            this.tbody.appendChild(tr);
            return;
        }

        lista.forEach(item => {
            const tr = document.createElement('tr');
            tr.dataset.id = item.id;
            
            tr.innerHTML = `
                &lt;td>${item.nombre ?? '-'}&lt;/td>
                &lt;td>${item.apellidos ?? '-'}&lt;/td>
                &lt;td>${item.nombreCurso ?? '-'}&lt;/td>
                &lt;td>
                    &lt;button class="btn btn-sm btn-primary btn-certificado" data-id="${item.id}">Generar Certificado&lt;/button>
                &lt;/td>
            `;
            this.tbody.appendChild(tr);
        });
        
        // Ejecutar listeners DESPUÉS de pintar, si es necesario (ej: para los botones)
        this.addListenersCertificados();
    }
    
    /**
     * Añade listeners a los botones de Generar Certificado después de pintar la tabla.
     */
    addListenersCertificados() {
        if (!this.tbody) return;
        
        // Buscamos todos los botones que acabamos de pintar
        const botonesCertificado = this.tbody.querySelectorAll('.btn-certificado');
        
        botonesCertificado.forEach(boton => {
            // Pasamos el ID del alumno al controlador
            boton.addEventListener('click', (e) => {
                const alumnoId = e.currentTarget.dataset.id;
                console.log(`DEBUG VISTA: Botón de certificado pulsado para ID: ${alumnoId}`);
                // Aquí deberías llamar al controlador para iniciar la descarga del PDF
                this.controlador.generarCertificado(alumnoId, new Date().getFullYear(), new Date().getFullYear() + 1); 
            });
        });
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ControladorPadres.html">ControladorPadres</a></li><li><a href="ControladorSecretaria.html">ControladorSecretaria</a></li><li><a href="Datatable.html">Datatable</a></li><li><a href="Login.html">Login</a></li><li><a href="LoginGoogle.html">LoginGoogle</a></li><li><a href="Modelo.html">Modelo</a></li><li><a href="Recuperar.html">Recuperar</a></li><li><a href="Registro.html">Registro</a></li><li><a href="Restaurar.html">Restaurar</a></li><li><a href="Vista.html">Vista</a></li><li><a href="VistaGestionCertificados_VistaGestionCertificados.html">VistaGestionCertificados</a></li><li><a href="VistaGestionDiaria.html">VistaGestionDiaria</a></li><li><a href="VistaGestionHijos.html">VistaGestionHijos</a></li><li><a href="VistaGestionMensual.html">VistaGestionMensual</a></li><li><a href="VistaGestionPadres.html">VistaGestionPadres</a></li><li><a href="VistaMenuSecretaria.html">VistaMenuSecretaria</a></li><li><a href="VistaModificarPadres.html">VistaModificarPadres</a></li><li><a href="VistaQ19.html">VistaQ19</a></li><li><a href="VistaResumenMensual.html">VistaResumenMensual</a></li></ul><h3>Global</h3><ul><li><a href="global.html#API_URL">API_URL</a></li><li><a href="global.html#cargarFestivos">cargarFestivos</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#fetchJson">fetchJson</a></li><li><a href="global.html#formatDisplayISO">formatDisplayISO</a></li><li><a href="global.html#getDisplayedMonth">getDisplayedMonth</a></li><li><a href="global.html#getInputValue">getInputValue</a></li><li><a href="global.html#initMenusLinks">initMenusLinks</a></li><li><a href="global.html#isValidISODate">isValidISODate</a></li><li><a href="global.html#loadMenus">loadMenus</a></li><li><a href="global.html#mostrarFeedback">mostrarFeedback</a></li><li><a href="global.html#renderAllMonths">renderAllMonths</a></li><li><a href="global.html#renderForMonth">renderForMonth</a></li><li><a href="global.html#renderTabla">renderTabla</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 03 2025 13:40:16 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
