<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/menusLinks.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/menusLinks.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// Código para cargar los PDFs de /menus y actualizar el enlace según el mes mostrado en el calendario
const API_LIST = 'php/api/index.php?controller=menus&amp;action=list';
let menusData = {};

/**
 * Carga la lista de menús desde la API y normaliza las URLs.
 */
async function loadMenus() {
  try {
    const res = await fetch(API_LIST, { cache: 'no-store' });
    if (!res.ok) throw new Error('No se pudo listar menús');
    menusData = await res.json();

    // Normaliza las URLs recibidas para apuntar siempre a la carpeta /menus/
    const getProjectBasePath = () => {
      const parts = window.location.pathname.split('/').filter(Boolean);
      const idx = parts.findIndex(p => p.toLowerCase().includes('comedor'));
      if (idx >= 0) return '/' + parts.slice(0, idx + 1).join('/');
      // fallback: si no encuentra "comedor" usar la carpeta del proyecto (primer segmento)
      // así no añadimos el nombre de fichero (ej. index.html) a la ruta base
      if (parts.length >= 1) return '/' + parts[0];
      return '';
    };

    const base = window.location.origin + getProjectBasePath() + '/menus/';

    const normalize = (val) => {
      if (!val) return null;
      val = String(val).trim();
      // Si ya es URL absoluta (http(s) o protocolo relativo //), devolver tal cual
      if (/^(https?:)?\/\//.test(val)) return val;
      // Si empieza por "/" es ruta absoluta respecto al host actual
      if (val.startsWith('/')) return window.location.origin + val;
      // Si es una ruta relativa o solo nombre de fichero, tomar el último segmento y construir con base detectada
      let filename = val.split('/').pop();
      return base + encodeURIComponent(filename);
    };

    for (const k in menusData) {
      menusData[k] = normalize(menusData[k]);
    }

  } catch (e) {
    console.error('Error cargando menús', e);
    menusData = {};
  }
}

const monthNames = ['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
function monthNameToNumber(text) {
  if (!text) return null;
  const t = text.toLowerCase();
  for (let i = 0; i &lt; monthNames.length; i++) {
    if (t.includes(monthNames[i])) return i + 1;
  }
  const m = text.match(/\b(0?[1-9]|1[0-2])\b/);
  return m ? parseInt(m[0], 10) : null;
}

/**
 * se obtiene el mes actualmente mostrado en el calendario.
 * @returns Número del mes actualmente mostrado en el calendario (1-12). Si no se puede determinar, devuelve el mes actual.
 */
function getDisplayedMonth() {
  const el = document.getElementById('monthYear');
  if (el &amp;&amp; el.textContent) {
    const num = monthNameToNumber(el.textContent);
    if (num) return num;
  }
  return (new Date()).getMonth() + 1;
}

const monthsDisplay = ['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];

/**
 * renderiza el enlace al menú del mes proporcionado.
 * @param {*} month 
 */
function renderForMonth(month) {
  const cont = document.getElementById('menusLinks');
  if (!cont) return;
  if (!month) {
    cont.innerHTML = '&lt;span class="text-muted">Seleccione un mes en el calendario.&lt;/span>';
    return;
  }
  const url = menusData[month] || null;
  if (url) {
    cont.innerHTML = `&lt;a href="${url}" target="_blank" rel="noopener">Menú ${monthsDisplay[month-1]}&lt;/a>`;
  } else {
    cont.innerHTML = '&lt;span class="text-muted">No hay menú para este mes.&lt;/span>';
  }
}

/**
 * renderiza los enlaces a todos los menús mensuales.
 */
function renderAllMonths() {
  const cont = document.getElementById('menusLinks');
  if (!cont) return;
  let html = '&lt;div class="d-flex flex-wrap justify-content-center">';
  for (let m = 1; m &lt;= 12; m++) {
    const url = menusData[m] || null;
    if (url) {
      html += `&lt;a class="badge badge-primary m-1 p-2" href="${url}" target="_blank" rel="noopener">Menú ${monthsDisplay[m-1]}&lt;/a>`;
    } else {
      html += `&lt;span class="badge badge-secondary m-1 p-2 text-muted">Sin ${monthsDisplay[m-1]}&lt;/span>`;
    }
  }
  html += '&lt;/div>';
  cont.innerHTML = html;
}

/**
 * Inicializa la carga de menús y los enlaces en la interfaz.
 */
async function initMenusLinks() {
  await loadMenus();
  renderAllMonths();

  const monthYearEl = document.getElementById('monthYear');
  if (monthYearEl) {
    const mo = new MutationObserver(() => renderAllMonths());
    mo.observe(monthYearEl, { childList: true, characterData: true, subtree: true });
  }

  document.getElementById('prevMonth')?.addEventListener('click', () => setTimeout(() => renderForMonth(getDisplayedMonth()), 80));
  document.getElementById('nextMonth')?.addEventListener('click', () => setTimeout(() => renderForMonth(getDisplayedMonth()), 80));
}

// Auto-iniciar cuando se cargue el módulo
initMenusLinks();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ControladorPadres.html">ControladorPadres</a></li><li><a href="ControladorSecretaria.html">ControladorSecretaria</a></li><li><a href="Datatable.html">Datatable</a></li><li><a href="Login.html">Login</a></li><li><a href="LoginGoogle.html">LoginGoogle</a></li><li><a href="Modelo.html">Modelo</a></li><li><a href="Recuperar.html">Recuperar</a></li><li><a href="Registro.html">Registro</a></li><li><a href="Restaurar.html">Restaurar</a></li><li><a href="Vista.html">Vista</a></li><li><a href="VistaGestionCertificados_VistaGestionCertificados.html">VistaGestionCertificados</a></li><li><a href="VistaGestionDiaria.html">VistaGestionDiaria</a></li><li><a href="VistaGestionHijos.html">VistaGestionHijos</a></li><li><a href="VistaGestionMensual.html">VistaGestionMensual</a></li><li><a href="VistaGestionPadres.html">VistaGestionPadres</a></li><li><a href="VistaMenuSecretaria.html">VistaMenuSecretaria</a></li><li><a href="VistaModificarPadres.html">VistaModificarPadres</a></li><li><a href="VistaQ19.html">VistaQ19</a></li><li><a href="VistaResumenMensual.html">VistaResumenMensual</a></li></ul><h3>Global</h3><ul><li><a href="global.html#API_URL">API_URL</a></li><li><a href="global.html#cargarFestivos">cargarFestivos</a></li><li><a href="global.html#escapeHtml">escapeHtml</a></li><li><a href="global.html#fetchJson">fetchJson</a></li><li><a href="global.html#formatDisplayISO">formatDisplayISO</a></li><li><a href="global.html#getDisplayedMonth">getDisplayedMonth</a></li><li><a href="global.html#getInputValue">getInputValue</a></li><li><a href="global.html#initMenusLinks">initMenusLinks</a></li><li><a href="global.html#isValidISODate">isValidISODate</a></li><li><a href="global.html#loadMenus">loadMenus</a></li><li><a href="global.html#mostrarFeedback">mostrarFeedback</a></li><li><a href="global.html#renderAllMonths">renderAllMonths</a></li><li><a href="global.html#renderForMonth">renderForMonth</a></li><li><a href="global.html#renderTabla">renderTabla</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Wed Dec 03 2025 13:40:16 GMT+0100 (hora estándar de Europa central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
